# Receipt endpoints
/api/v1/receipts:
  post:
    tags:
      - Чеки
    summary: Загрузить чек
    description: Загружает файл чека (изображение или PDF) с возможностью привязки к транзакции
    security:
      - bearerAuth: []
    requestBody:
      required: true
      content:
        multipart/form-data:
          schema:
            $ref: '../schemas/receipts.yaml#/UploadReceiptRequest'
    responses:
      '201':
        description: Чек успешно загружен
        content:
          application/json:
            schema:
              $ref: '../schemas/receipts.yaml#/UploadReceiptResponse'
      '400':
        description: Некорректный запрос или неподдерживаемый формат файла
        content:
          application/json:
            schema:
              $ref: '../schemas/common.yaml#/ValidationErrorResponse'
      '401':
        description: Пользователь не авторизован
        content:
          application/json:
            schema:
              $ref: '../schemas/common.yaml#/ErrorResponse'
      '413':
        description: Размер файла превышает максимально допустимый
        content:
          application/json:
            schema:
              $ref: '../schemas/common.yaml#/ErrorResponse'
      '500':
        description: Внутренняя ошибка сервера
        content:
          application/json:
            schema:
              $ref: '../schemas/common.yaml#/ErrorResponse'

  get:
    tags:
      - Чеки
    summary: Получить список чеков
    description: Получает список чеков пользователя с возможностью фильтрации за период и пагинацией
    security:
      - bearerAuth: []
    parameters:
      - name: from
        in: query
        description: Дата начала периода (формат yyyy-MM-dd)
        required: false
        schema:
          type: string
          format: date
        example: "2024-01-01"
      - name: to
        in: query
        description: Дата окончания периода (формат yyyy-MM-dd)
        required: false
        schema:
          type: string
          format: date
        example: "2024-12-31"
      - name: transactionId
        in: query
        description: ID транзакции для фильтрации
        required: false
        schema:
          type: string
          format: uuid
      - name: hasTransaction
        in: query
        description: Фильтр по наличию привязки к транзакции
        required: false
        schema:
          type: boolean
      - name: page
        in: query
        description: Номер страницы (начиная с 0)
        required: false
        schema:
          type: integer
          minimum: 0
          default: 0
        example: 0
      - name: size
        in: query
        description: Количество элементов на странице
        required: false
        schema:
          type: integer
          minimum: 1
          maximum: 100
          default: 20
        example: 20
    responses:
      '200':
        description: Список чеков успешно получен
        content:
          application/json:
            schema:
              $ref: '../schemas/receipts.yaml#/PagedReceiptResponse'
      '401':
        description: Пользователь не авторизован
        content:
          application/json:
            schema:
              $ref: '../schemas/common.yaml#/ErrorResponse'
      '500':
        description: Внутренняя ошибка сервера
        content:
          application/json:
            schema:
              $ref: '../schemas/common.yaml#/ErrorResponse'

/api/v1/receipts/{id}:
  get:
    tags:
      - Чеки
    summary: Получить информацию о чеке
    description: Получает детальную информацию о чеке по его ID
    security:
      - bearerAuth: []
    parameters:
      - name: id
        in: path
        description: ID чека
        required: true
        schema:
          type: string
          format: uuid
    responses:
      '200':
        description: Информация о чеке успешно получена
        content:
          application/json:
            schema:
              $ref: '../schemas/receipts.yaml#/ReceiptResponse'
      '401':
        description: Пользователь не авторизован
        content:
          application/json:
            schema:
              $ref: '../schemas/common.yaml#/ErrorResponse'
      '403':
        description: Доступ к чеку запрещен
        content:
          application/json:
            schema:
              $ref: '../schemas/common.yaml#/ErrorResponse'
      '404':
        description: Чек не найден
        content:
          application/json:
            schema:
              $ref: '../schemas/common.yaml#/ErrorResponse'
      '500':
        description: Внутренняя ошибка сервера
        content:
          application/json:
            schema:
              $ref: '../schemas/common.yaml#/ErrorResponse'

  patch:
    tags:
      - Чеки
    summary: Обновить привязку чека к транзакции
    description: Обновляет привязку чека к транзакции (привязка или отвязка)
    security:
      - bearerAuth: []
    parameters:
      - name: id
        in: path
        description: ID чека
        required: true
        schema:
          type: string
          format: uuid
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../schemas/receipts.yaml#/UpdateReceiptRequest'
    responses:
      '200':
        description: Чек успешно обновлен
        content:
          application/json:
            schema:
              $ref: '../schemas/receipts.yaml#/ReceiptResponse'
      '400':
        description: Некорректный запрос
        content:
          application/json:
            schema:
              $ref: '../schemas/common.yaml#/ValidationErrorResponse'
      '401':
        description: Пользователь не авторизован
        content:
          application/json:
            schema:
              $ref: '../schemas/common.yaml#/ErrorResponse'
      '403':
        description: Доступ к чеку запрещен
        content:
          application/json:
            schema:
              $ref: '../schemas/common.yaml#/ErrorResponse'
      '404':
        description: Чек не найден
        content:
          application/json:
            schema:
              $ref: '../schemas/common.yaml#/ErrorResponse'
      '500':
        description: Внутренняя ошибка сервера
        content:
          application/json:
            schema:
              $ref: '../schemas/common.yaml#/ErrorResponse'

  delete:
    tags:
      - Чеки
    summary: Удалить чек
    description: Удаляет чек и связанный с ним файл
    security:
      - bearerAuth: []
    parameters:
      - name: id
        in: path
        description: ID чека
        required: true
        schema:
          type: string
          format: uuid
    responses:
      '204':
        description: Чек успешно удален
      '401':
        description: Пользователь не авторизован
        content:
          application/json:
            schema:
              $ref: '../schemas/common.yaml#/ErrorResponse'
      '403':
        description: Доступ к чеку запрещен
        content:
          application/json:
            schema:
              $ref: '../schemas/common.yaml#/ErrorResponse'
      '404':
        description: Чек не найден
        content:
          application/json:
            schema:
              $ref: '../schemas/common.yaml#/ErrorResponse'
      '500':
        description: Внутренняя ошибка сервера
        content:
          application/json:
            schema:
              $ref: '../schemas/common.yaml#/ErrorResponse'

/api/v1/receipts/{id}/download:
  get:
    tags:
      - Чеки
    summary: Скачать файл чека
    description: Скачивает оригинальный файл чека
    security:
      - bearerAuth: []
    parameters:
      - name: id
        in: path
        description: ID чека
        required: true
        schema:
          type: string
          format: uuid
    responses:
      '200':
        description: Файл чека успешно загружен
        content:
          image/jpeg:
            schema:
              $ref: '../schemas/receipts.yaml#/ReceiptDownloadResponse'
          image/png:
            schema:
              $ref: '../schemas/receipts.yaml#/ReceiptDownloadResponse'
          application/pdf:
            schema:
              $ref: '../schemas/receipts.yaml#/ReceiptDownloadResponse'
        headers:
          Content-Disposition:
            description: Указывает браузеру, что файл должен быть скачан
            schema:
              type: string
              example: "attachment; filename=receipt_123.jpg"
          Content-Type:
            description: MIME тип файла
            schema:
              type: string
              example: "image/jpeg"
      '401':
        description: Пользователь не авторизован
        content:
          application/json:
            schema:
              $ref: '../schemas/common.yaml#/ErrorResponse'
      '403':
        description: Доступ к чеку запрещен
        content:
          application/json:
            schema:
              $ref: '../schemas/common.yaml#/ErrorResponse'
      '404':
        description: Чек не найден или файл не доступен
        content:
          application/json:
            schema:
              $ref: '../schemas/common.yaml#/ErrorResponse'
      '500':
        description: Внутренняя ошибка сервера
        content:
          application/json:
            schema:
              $ref: '../schemas/common.yaml#/ErrorResponse'